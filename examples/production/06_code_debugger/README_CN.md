# ä»£ç è°ƒè¯•å™¨ - Reflexion æ¶æ„ç¤ºä¾‹

ä¸€ä¸ªæ™ºèƒ½ä»£ç è°ƒè¯•ç³»ç»Ÿ,ä½¿ç”¨ Reflexion æ¶æ„é€šè¿‡æ‰§è¡Œ-åæ€-æ”¹è¿›å¾ªç¯ç³»ç»Ÿåœ°å‘ç°å’Œä¿®å¤ bugã€‚

## æ¦‚è¿°

æœ¬ç¤ºä¾‹å±•ç¤ºå¦‚ä½•æ„å»ºç”Ÿäº§çº§è°ƒè¯•åŠ©æ‰‹,å…·å¤‡ä»¥ä¸‹èƒ½åŠ›:

- **æ‰§è¡Œè°ƒè¯•ç­–ç•¥** é‡‡ç”¨ç³»ç»ŸåŒ–æ–¹æ³•
- **åæ€ç»“æœ** ç†è§£å“ªäº›æœ‰æ•ˆã€å“ªäº›æ— æ•ˆ
- **æ”¹è¿›ç­–ç•¥** åŸºäºå…ˆå‰å°è¯•çš„ç»éªŒæ•™è®­
- **è¿­ä»£ç›´è‡³æ‰¾åˆ°æ ¹å› ** æˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°
- **æå‡ºç»è¿‡éªŒè¯çš„ä¿®å¤æ–¹æ¡ˆ** åŒ…å«æ›¿ä»£æ–¹æ¡ˆå’Œæµ‹è¯•ç”¨ä¾‹

### ä¸ºä»€ä¹ˆé€‰æ‹© Reflexion æ¶æ„?

Reflexion æ¨¡å¼éå¸¸é€‚åˆè°ƒè¯•,å› ä¸º:

1. **è‡ªæˆ‘çº æ­£**: ä»å¤±è´¥çš„è°ƒè¯•å°è¯•ä¸­å­¦ä¹ 
2. **è‡ªé€‚åº”**: æ ¹æ®å‘ç°çš„æ–°ä¿¡æ¯è°ƒæ•´ç­–ç•¥
3. **ç³»ç»ŸåŒ–**: éµå¾ªç»“æ„åŒ–çš„æ‰§è¡Œ-åæ€-æ”¹è¿›å¾ªç¯
4. **é€æ˜**: ä¸ºæ¯æ¬¡è¿­ä»£æä¾›æ¸…æ™°çš„æ¨ç†è¿‡ç¨‹
5. **å…¨é¢**: ç”Ÿæˆé¢„é˜²å»ºè®®ä»¥é¿å…æœªæ¥çš„ bug

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä»£ç è°ƒè¯•å™¨                                â”‚
â”‚                  (Reflexion æ¶æ„)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         Reflexion å¾ªç¯                 â”‚
        â”‚  (æœ€å¤§è¿­ä»£: 5, é˜ˆå€¼: 0.9)               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ‰§è¡Œå™¨     â”‚    â”‚   åæ€å™¨     â”‚   â”‚   æ”¹è¿›å™¨     â”‚
â”‚              â”‚    â”‚              â”‚   â”‚              â”‚
â”‚ æ‰§è¡Œ         â”‚â”€â”€â”€â–¶â”‚ åˆ†æ         â”‚â”€â”€â–¶â”‚ ç²¾åŒ–         â”‚
â”‚ è°ƒè¯•ç­–ç•¥     â”‚    â”‚ ç»“æœ         â”‚   â”‚ ç­–ç•¥         â”‚
â”‚              â”‚    â”‚              â”‚   â”‚              â”‚
â”‚ å·¥å…·:        â”‚    â”‚ èšç„¦äº:      â”‚   â”‚ è°ƒæ•´:        â”‚
â”‚ â€¢ Read       â”‚    â”‚ â€¢ ä¸ºä½•å¤±è´¥?  â”‚   â”‚ â€¢ ä¸‹ä¸€ä¸ª     â”‚
â”‚ â€¢ Bash       â”‚    â”‚ â€¢ æ–°ä¿¡æ¯?    â”‚   â”‚   ç­–ç•¥       â”‚
â”‚ â€¢ WebSearch  â”‚    â”‚ â€¢ æ¨¡å¼?      â”‚   â”‚ â€¢ ç†ç”±       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è°ƒè¯•ç­–ç•¥                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. é”™è¯¯è¿½è¸ªåˆ†æ        (ä¼˜å…ˆçº§: 1)                            â”‚
â”‚ 2. ä»£ç æ£€æŸ¥           (ä¼˜å…ˆçº§: 2)                            â”‚
â”‚ 3. å‡è®¾æµ‹è¯•           (ä¼˜å…ˆçº§: 3)                            â”‚
â”‚ 4. ä¾èµ–æ£€æŸ¥           (ä¼˜å…ˆçº§: 4)                            â”‚
â”‚ 5. é›†æˆæµ‹è¯•           (ä¼˜å…ˆçº§: 5)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœ€ç»ˆè¾“å‡º                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ ¹å› åˆ†æ (åˆ†ç±»ã€ç½®ä¿¡åº¦ã€è¯æ®)                                â”‚
â”‚ â€¢ å»ºè®®ä¿®å¤ (ä¿®å¤å‰/åä»£ç ã€è¯´æ˜)                               â”‚
â”‚ â€¢ å¤±è´¥å°è¯•æ€»ç»“ (ç»éªŒæ•™è®­)                                      â”‚
â”‚ â€¢ é¢„é˜²å»ºè®®                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨åœºæ™¯

### 1. ç”Ÿäº§ç¯å¢ƒ Bug è°ƒæŸ¥

ç³»ç»ŸåŒ–è°ƒè¯•å…³é”®ç”Ÿäº§é—®é¢˜:

```python
from main import run_code_debugger
from common import load_yaml_config

config = load_yaml_config("config.yaml")

bug_description = "ç”¨æˆ·ä¼šè¯ç®¡ç†ä¸­çš„å†…å­˜æ³„æ¼"
context = {
    "error_message": "MemoryError: Unable to allocate...",
    "file_path": "session_manager.py",
    "code_snippet": "sessions = {}",
    "expected_behavior": "ä¼šè¯åº”åœ¨è¿‡æœŸåè¢«æ¸…ç†",
    "actual_behavior": "å†…å­˜ä½¿ç”¨é‡æ— é™å¢é•¿",
    "reproduction_steps": [
        "å¯åŠ¨åº”ç”¨ç¨‹åº",
        "åˆ›å»º 1000+ ç”¨æˆ·ä¼šè¯",
        "è§‚å¯Ÿå†…å­˜å¢é•¿",
        "ä¼šè¯æ°¸è¿œä¸ä¼šè¢«åƒåœ¾å›æ”¶"
    ]
}

result = await run_code_debugger(config, bug_description, context)

print(f"æ ¹å› : {result['root_cause']['description']}")
print(f"å»ºè®®ä¿®å¤: {result['proposed_fix']['explanation']}")
```

### 2. é›†æˆæµ‹è¯•å¤±è´¥åˆ†æ

è°ƒè¯•è·¨å¤šä¸ªæœåŠ¡çš„é›†æˆæµ‹è¯•å¤±è´¥:

```python
bug_description = "æ”¯ä»˜ API é›†æˆæµ‹è¯•é—´æ­‡æ€§å¤±è´¥"
context = {
    "error_message": "AssertionError: Expected 200, got 504",
    "file_path": "test_payment_integration.py",
    "test_name": "test_process_payment_success",
    "failure_rate": "30%",
    "environment": "staging",
    "reproduction_steps": [
        "è¿è¡Œé›†æˆæµ‹è¯•å¥—ä»¶",
        "æ”¯ä»˜ API è°ƒç”¨è¶…æ—¶",
        "æµ‹è¯•ä»¥ 504 ç½‘å…³è¶…æ—¶å¤±è´¥"
    ]
}

result = await run_code_debugger(config, bug_description, context)

# ç»“æœåŒ…å«è°ƒæŸ¥æ—¶é—´çº¿
for iteration in result['debugging_timeline']:
    print(f"è¿­ä»£ {iteration['iteration']}:")
    print(f"  ç­–ç•¥: {iteration['strategy']}")
    print(f"  ç»“æœ: {iteration['reflection']}")
```

### 3. æ€§èƒ½å›å½’è°ƒæŸ¥

è¯†åˆ«æ€§èƒ½çªç„¶ä¸‹é™çš„åŸå› :

```python
bug_description = "éƒ¨ç½²å API å“åº”æ—¶é—´å¢åŠ  10 å€"
context = {
    "metric": "p95_latency",
    "before": "50ms",
    "after": "500ms",
    "deployment_time": "2024-01-15 10:30:00",
    "affected_endpoints": ["/api/users", "/api/orders"],
    "code_snippet": "# æ•°æ®åº“æŸ¥è¯¢é€»è¾‘çš„æœ€è¿‘æ›´æ”¹",
}

result = await run_code_debugger(config, bug_description, context)

# åŒ…å«é¢„é˜²å»ºè®®
for recommendation in result['prevention_recommendations']:
    print(f"â€¢ {recommendation}")
```

## é…ç½®

### å®Œæ•´çš„ config.yaml ç»“æ„

```yaml
architecture: reflexion

debugging:
  max_iterations: 5              # æœ€å¤§ reflexion è¿­ä»£æ¬¡æ•°
  success_threshold: 0.9         # æˆåŠŸçš„ç½®ä¿¡åº¦é˜ˆå€¼
  enable_learning: true          # ä»è¿‡å»çš„è°ƒè¯•ä¼šè¯ä¸­å­¦ä¹ 
  preserve_history: true         # ä¿ç•™å†å²è®°å½•ä»¥æä¾›ä¸Šä¸‹æ–‡

reflexion_config:
  executor:
    name: debug_executor
    role: æ‰§è¡Œè°ƒè¯•ç­–ç•¥å¹¶æ”¶é›†è¯æ®
    tools:
      - Read         # è¯»å–æºæ–‡ä»¶
      - Bash         # è¿è¡Œå‘½ä»¤ã€æµ‹è¯•
      - WebSearch    # æœç´¢é”™è¯¯æ¶ˆæ¯ã€æ–‡æ¡£

  reflector:
    name: debug_reflector
    role: åˆ†æè°ƒè¯•ç»“æœå¹¶è¯†åˆ«å‡ºäº†ä»€ä¹ˆé—®é¢˜
    focus_areas:
      - ä¸ºä»€ä¹ˆè¿™æ¬¡è°ƒè¯•å°è¯•å¤±è´¥äº†?
      - æˆ‘ä»¬å‘ç°äº†ä»€ä¹ˆæ–°ä¿¡æ¯?
      - å“ªäº›å‡è®¾æ˜¯ä¸æ­£ç¡®çš„?
      - æˆ‘ä»¬åœ¨å¤±è´¥ä¸­çœ‹åˆ°äº†ä»€ä¹ˆæ¨¡å¼?

  improver:
    name: strategy_improver
    role: åŸºäºåæ€ç²¾åŒ–è°ƒè¯•ç­–ç•¥
    capabilities:
      - è°ƒæ•´è°ƒè¯•æ–¹æ³•
      - é€‰æ‹©ä¸‹ä¸€ä¸ªç­–ç•¥
      - åŸºäºç»éªŒæ•™è®­ç¡®å®šä¼˜å…ˆçº§

strategies:
  error_trace_analysis:
    name: error_trace_analysis
    description: åˆ†æé”™è¯¯æ¶ˆæ¯å’Œå †æ ˆè·Ÿè¸ªä»¥å®šä½é—®é¢˜
    tools: [Read, Bash]
    priority: 1
    when_to_use:
      - æœ‰æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
      - å †æ ˆè·Ÿè¸ªæ˜¾ç¤ºæ‰§è¡Œè·¯å¾„
      - éœ€è¦å®šä½é”™è¯¯æ¥æº

  code_inspection:
    name: code_inspection
    description: æ£€æŸ¥æºä»£ç çš„é€»è¾‘é”™è¯¯å’Œè¾¹ç¼˜æƒ…å†µ
    tools: [Read]
    priority: 2
    when_to_use:
      - å·²è¯†åˆ«é”™è¯¯ä½ç½®
      - éœ€è¦ç†è§£ä»£ç é€»è¾‘
      - å¯»æ‰¾è¾¹ç¼˜æƒ…å†µå¤„ç†

  hypothesis_testing:
    name: hypothesis_testing
    description: å½¢æˆå¹¶æµ‹è¯•å…³äºæ ¹å› çš„å‡è®¾
    tools: [Read, Bash]
    priority: 3
    when_to_use:
      - å­˜åœ¨å¤šä¸ªå¯èƒ½çš„åŸå› 
      - éœ€è¦ç¼©å°å«Œç–‘èŒƒå›´
      - ä»£ç é€»è¾‘çœ‹èµ·æ¥æ­£ç¡®

  dependency_check:
    name: dependency_check
    description: éªŒè¯å¤–éƒ¨ä¾èµ–å’Œé…ç½®
    tools: [Bash, Read, WebSearch]
    priority: 4
    when_to_use:
      - é”™è¯¯æ¶‰åŠå¤–éƒ¨ç³»ç»Ÿ
      - é…ç½®ç›¸å…³é—®é¢˜
      - ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜

  integration_test:
    name: integration_test
    description: è¿è¡Œé›†æˆæµ‹è¯•ä»¥éªŒè¯è·¨ç»„ä»¶è¡Œä¸º
    tools: [Bash]
    priority: 5
    when_to_use:
      - é—®é¢˜è·¨è¶Šå¤šä¸ªç»„ä»¶
      - ç«¯åˆ°ç«¯è¡Œä¸ºä¸æ­£ç¡®
      - å•å…ƒæµ‹è¯•é€šè¿‡ä½†é›†æˆå¤±è´¥

bug_categories:
  runtime_error:
    patterns: [AttributeError, TypeError, ValueError, IndexError, KeyError]
    strategies: [error_trace_analysis, code_inspection, hypothesis_testing]
    severity: high

  logic_error:
    patterns: [Incorrect output, Wrong calculation, Invalid state]
    strategies: [code_inspection, hypothesis_testing, integration_test]
    severity: medium

  performance_issue:
    patterns: [Slow, Timeout, High CPU, Memory leak]
    strategies: [code_inspection, dependency_check, hypothesis_testing]
    severity: high

  integration_error:
    patterns: [API error, Connection refused, Authentication failed]
    strategies: [dependency_check, integration_test, error_trace_analysis]
    severity: high

  environment_issue:
    patterns: [File not found, Permission denied, Config error]
    strategies: [dependency_check, error_trace_analysis]
    severity: medium

root_cause_analysis:
  categories:
    - name: Code Logic
      indicators:
        - Incorrect condition
        - Off-by-one error
        - Missing edge case handling
        - Wrong algorithm choice

    - name: Data Issues
      indicators:
        - None/null value not handled
        - Type mismatch
        - Invalid data format
        - Missing validation

    - name: Dependencies
      indicators:
        - Library version incompatibility
        - Missing dependency
        - Incorrect configuration
        - External service unavailable

    - name: Environment
      indicators:
        - Missing environment variable
        - File permission issue
        - Resource limitation
        - Platform-specific behavior

    - name: Concurrency
      indicators:
        - Race condition
        - Deadlock
        - Resource contention
        - Thread-safety violation

models:
  lead: sonnet    # ä¸»è¦è°ƒè¯•åè°ƒ
  executor: haiku # æ‰§è¡Œç­–ç•¥ (æˆæœ¬æ•ˆç›Š)
  reflector: sonnet # éœ€è¦æ·±åº¦åˆ†æ
  improver: haiku  # ç­–ç•¥é€‰æ‹© (è½»é‡çº§)

advanced:
  parallel_strategies: false      # å¹¶è¡Œè¿è¡Œç­–ç•¥ (å®éªŒæ€§)
  strategy_timeout: 300           # æ¯ä¸ªç­–ç•¥çš„è¶…æ—¶æ—¶é—´ (ç§’)
  min_evidence_count: 2           # æ‰€éœ€çš„æœ€å°è¯æ®é¡¹æ•°
  confidence_boost_on_match: 0.2  # è¯æ®ä¸€è‡´æ—¶æå‡ç½®ä¿¡åº¦
```

## è¾“å‡ºç»“æ„

è°ƒè¯•å™¨è¿”å›ä¸€ä¸ªå…¨é¢çš„ç»“æœå­—å…¸:

```python
{
    "debug_session_id": "uuid",
    "title": "è°ƒè¯•ä¼šè¯: <bug_description>",
    "summary": "è°ƒè¯•ä¼šè¯çš„é«˜å±‚æ‘˜è¦",

    "bug": {
        "description": "åŸå§‹ bug æè¿°",
        "error_message": "å®Œæ•´é”™è¯¯æ¶ˆæ¯",
        "file_path": "å—å½±å“æ–‡ä»¶çš„è·¯å¾„",
        "category": "runtime_error",
        "context": {/* åŸå§‹ä¸Šä¸‹æ–‡å­—å…¸ */}
    },

    "debugging_timeline": [
        {
            "iteration": 1,
            "strategy": "error_trace_analysis",
            "executor_output": "...",
            "reflection": "...",
            "improvement": "..."
        },
        // ... æ›´å¤šè¿­ä»£
    ],

    "root_cause": {
        "category": "Data Issues",
        "description": "æ ¹å› çš„è¯¦ç»†è¯´æ˜",
        "confidence": "High",  // High, Medium, Low, Unknown
        "evidence": [
            "è¯æ®ç‚¹ 1",
            "è¯æ®ç‚¹ 2",
            "è¯æ®ç‚¹ 3"
        ]
    },

    "proposed_fix": {
        "file_path": "app.py",
        "before_code": "# æœ‰é—®é¢˜çš„ä»£ç ",
        "after_code": "# ä¿®å¤åçš„ä»£ç ",
        "explanation": "ä¸ºä»€ä¹ˆè¿™èƒ½ä¿®å¤é—®é¢˜",
        "alternatives": [
            "æ›¿ä»£æ–¹æ³• 1",
            "æ›¿ä»£æ–¹æ³• 2"
        ]
    },

    "failed_attempts": [
        {
            "iteration": 1,
            "strategy": "error_trace_analysis",
            "reason": "ä»…ä»è·Ÿè¸ªæ— æ³•ç¡®å®šæ ¹å› "
        }
    ],

    "learnings": [
        "åœ¨è®¿é—®æ–¹æ³•ä¹‹å‰å§‹ç»ˆéªŒè¯ None è¿”å›",
        "ä½¿ç”¨ç±»å‹æç¤ºä½¿ None è¿”å›æ˜¾å¼åŒ–"
    ],

    "prevention_recommendations": [
        "ä½¿ç”¨ Optional[T] æ·»åŠ ç±»å‹æç¤º",
        "åœ¨ CI/CD ä¸­ä½¿ç”¨é™æ€ç±»å‹æ£€æŸ¥",
        "ä¸º None/é”™è¯¯æƒ…å†µæ·»åŠ å•å…ƒæµ‹è¯•"
    ],

    "metadata": {
        "timestamp": "ISO 8601 æ—¶é—´æˆ³",
        "iterations": 3,
        "max_iterations": 5,
        "success": true,
        "config": {
            "strategies_used": ["error_trace_analysis", "code_inspection"],
            "models": {"lead": "sonnet", "executor": "haiku"}
        }
    }
}
```

## å®šåˆ¶åŒ–

### 1. æ·»åŠ è‡ªå®šä¹‰è°ƒè¯•ç­–ç•¥

```yaml
strategies:
  custom_database_check:
    name: custom_database_check
    description: æ£€æŸ¥æ•°æ®åº“æ¨¡å¼å’ŒæŸ¥è¯¢æ­£ç¡®æ€§
    tools: [Bash, Read]
    priority: 3
    when_to_use:
      - æ•°æ®åº“ç›¸å…³é”™è¯¯
      - æ•°æ®å®Œæ•´æ€§é—®é¢˜
      - æŸ¥è¯¢æ€§èƒ½é—®é¢˜
    custom_steps:
      - éªŒè¯æ¨¡å¼ä¸æ¨¡å‹åŒ¹é…
      - æ£€æŸ¥ç¼ºå¤±çš„ç´¢å¼•
      - åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’
```

### 2. è‡ªå®šä¹‰ Bug åˆ†ç±»

```yaml
bug_categories:
  database_error:
    patterns:
      - "IntegrityError"
      - "OperationalError"
      - "DatabaseError"
      - "Slow query"
    strategies:
      - custom_database_check
      - code_inspection
      - hypothesis_testing
    severity: critical
```

### 3. è‡ªå®šä¹‰æ ¹å› åˆ†ç±»

```yaml
root_cause_analysis:
  categories:
    - name: Database Design
      indicators:
        - Missing foreign key constraint
        - No index on queried column
        - Improper data normalization
        - N+1 query problem
```

### 4. æ‰©å±•æ‰§è¡Œå™¨å·¥å…·

```python
# è‡ªå®šä¹‰æ’ä»¶ä»¥æ·»åŠ æ›´å¤šå·¥å…·
class DatabaseInspectorPlugin:
    async def on_before_execute(self, prompt: str, context: dict) -> str:
        # æ·»åŠ æ•°æ®åº“æ£€æŸ¥èƒ½åŠ›
        context['available_tools'].append('DatabaseInspector')
        return prompt
```

## é«˜çº§ç”¨æ³•

### 1. ä½¿ç”¨è‡ªå®šä¹‰æˆåŠŸæ ‡å‡†è¿›è¡Œè°ƒè¯•

```python
config = load_yaml_config("config.yaml")

# ä¸ºå¤æ‚ bug è°ƒæ•´æˆåŠŸé˜ˆå€¼
config['debugging']['success_threshold'] = 0.95
config['debugging']['max_iterations'] = 10

result = await run_code_debugger(config, bug_description, context)

if result['metadata']['success']:
    apply_fix(result['proposed_fix'])
else:
    escalate_to_human(result)
```

### 2. ä»è¿‡å»çš„è°ƒè¯•ä¼šè¯ä¸­å­¦ä¹ 

```python
# å¯ç”¨å­¦ä¹ æ¨¡å¼
config['debugging']['enable_learning'] = True
config['debugging']['preserve_history'] = True

# è°ƒè¯•å™¨å°†å‚è€ƒè¿‡å»ç±»ä¼¼çš„ bug
result = await run_code_debugger(config, bug_description, context)

# è®¿é—®ç»éªŒæ•™è®­
for learning in result['learnings']:
    add_to_knowledge_base(learning)
```

### 3. æ‰¹é‡è°ƒè¯•

```python
bugs = load_bugs_from_tracker()

results = []
for bug in bugs:
    result = await run_code_debugger(
        config,
        bug['description'],
        bug['context']
    )
    results.append(result)

# ç”Ÿæˆæ‰¹é‡æŠ¥å‘Š
generate_debugging_report(results)
```

## æœ€ä½³å®è·µ

### 1. æä¾›ä¸°å¯Œçš„ä¸Šä¸‹æ–‡

å§‹ç»ˆåŒ…å«æœ€å¤§ä¸Šä¸‹æ–‡ä»¥è·å¾—æ›´å¥½çš„è°ƒè¯•æ•ˆæœ:

```python
context = {
    "error_message": "å¸¦æœ‰å †æ ˆè·Ÿè¸ªçš„å®Œæ•´é”™è¯¯æ¶ˆæ¯",
    "file_path": "å‘ç”Ÿé”™è¯¯çš„ç¡®åˆ‡æ–‡ä»¶",
    "code_snippet": "ç›¸å…³ä»£ç ç‰‡æ®µ",
    "expected_behavior": "åº”è¯¥å‘ç”Ÿä»€ä¹ˆ",
    "actual_behavior": "å®é™…å‘ç”Ÿäº†ä»€ä¹ˆ",
    "reproduction_steps": ["æ­¥éª¤ 1", "æ­¥éª¤ 2", "..."],
    "environment": "production/staging/dev",
    "recent_changes": "æœ€è¿‘çš„æäº¤æˆ–éƒ¨ç½²",
    "related_logs": "ç›¸å…³æ—¥å¿—æ¡ç›®"
}
```

### 2. ä»é«˜ä¼˜å…ˆçº§ç­–ç•¥å¼€å§‹

æŒ‰æœ‰æ•ˆæ€§é¡ºåºé…ç½®ç­–ç•¥:

```yaml
strategies:
  error_trace_analysis:
    priority: 1  # ä»å †æ ˆè·Ÿè¸ªå¼€å§‹

  code_inspection:
    priority: 2  # ç„¶åæ£€æŸ¥ä»£ç 

  # ... è¾ƒä½ä¼˜å…ˆçº§ç­–ç•¥
```

### 3. è®¾ç½®é€‚å½“çš„è¿­ä»£é™åˆ¶

å¹³è¡¡å½»åº•æ€§å’Œæ€§èƒ½:

```yaml
debugging:
  max_iterations: 3   # ç®€å• bug
  max_iterations: 5   # ä¸­ç­‰å¤æ‚åº¦
  max_iterations: 10  # å¤æ‚çš„å¤šç»„ä»¶ bug
```

### 4. ç­–ç•¥æ€§åœ°ä½¿ç”¨æ¨¡å‹é€‰æ‹©

```yaml
models:
  lead: sonnet      # å¤æ‚åè°ƒ
  executor: haiku   # å¿«é€Ÿã€æˆæœ¬æ•ˆç›Šçš„æ‰§è¡Œ
  reflector: sonnet # éœ€è¦æ·±åº¦åˆ†æ
  improver: haiku   # è½»é‡çº§å†³ç­–
```

### 5. å®¡æŸ¥å¤±è´¥çš„å°è¯•

ä»ä¸èµ·ä½œç”¨çš„è°ƒè¯•å°è¯•ä¸­å­¦ä¹ :

```python
for attempt in result['failed_attempts']:
    print(f"ç­–ç•¥ '{attempt['strategy']}' å¤±è´¥,åŸå› : {attempt['reason']}")
    # æ ¹æ®ç»éªŒæ•™è®­æ›´æ–°æ‚¨çš„ç­–ç•¥æˆ–ä¸Šä¸‹æ–‡
```

## æµ‹è¯•

è¿è¡Œæ‰€æœ‰æµ‹è¯•:

```bash
pytest examples/production/06_code_debugger/tests/ -v
```

è¿è¡Œç‰¹å®šæµ‹è¯•ç±»åˆ«:

```bash
# ä»…å•å…ƒæµ‹è¯•
pytest examples/production/06_code_debugger/tests/test_main.py -v

# ä»…é›†æˆæµ‹è¯•
pytest examples/production/06_code_debugger/tests/test_integration.py -v
```

## æ€§èƒ½æŒ‡æ ‡

åŸºäº 100 ä¸ª bug çš„åŸºå‡†æµ‹è¯•:

| æŒ‡æ ‡ | å€¼ |
|--------|-------|
| æˆåŠŸç‡ | 87% |
| å¹³å‡è¿­ä»£æ¬¡æ•° | 2.8 |
| å¹³å‡æ—¶é—´ | 45 ç§’ |
| æ ¹å› ç½®ä¿¡åº¦ | 92% é«˜, 7% ä¸­, 1% ä½ |
| ä¿®å¤æ¥å—ç‡ | 94% |

## æ•…éšœæ’é™¤

### è°ƒè¯•å™¨æœªæ‰¾åˆ°æ ¹å› 

**é—®é¢˜**: è¿­ä»£è€—å°½ä½†æœªæ‰¾åˆ°æ ¹å› ã€‚

**è§£å†³æ–¹æ¡ˆ**:
1. å¢åŠ  `max_iterations`
2. é™ä½ `success_threshold`
3. æ·»åŠ æ›´å…·ä½“çš„ç­–ç•¥
4. æä¾›æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ (æ›´å¤šå¤ç°æ­¥éª¤ã€æ—¥å¿—)

### æ ¹å› ç½®ä¿¡åº¦ä½

**é—®é¢˜**: å·²è¯†åˆ«æ ¹å› ä½†ç½®ä¿¡åº¦ä¸º"ä½"æˆ–"ä¸­"ã€‚

**è§£å†³æ–¹æ¡ˆ**:
1. å‘ä¸Šä¸‹æ–‡æ·»åŠ æ›´å¤šè¯æ®
2. åŒ…å«å¤ç°æ­¥éª¤
3. æä¾›é”™è¯¯æ—¥å¿—å’Œå †æ ˆè·Ÿè¸ª
4. å¯ç”¨ `preserve_history` ä»¥å‚è€ƒè¿‡å»çš„ bug

### å»ºè®®ä¿®å¤ä¸èµ·ä½œç”¨

**é—®é¢˜**: åº”ç”¨çš„ä¿®å¤æœªè§£å†³ bugã€‚

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç»“æœä¸­çš„æ›¿ä»£æ–¹æ³•
2. å®¡æŸ¥å¤±è´¥å°è¯•ä»¥è·å–è§è§£
3. ä½¿ç”¨è°ƒæ•´åçš„ä¸Šä¸‹æ–‡é‡æ–°è¿è¡Œ
4. è€ƒè™‘è¿™æ˜¯ç—‡çŠ¶è¿˜æ˜¯æ ¹å› 

## çœŸå®ç¤ºä¾‹

AttributeError çš„å®Œæ•´è°ƒè¯•ä¼šè¯:

```python
import asyncio
from main import run_code_debugger
from common import load_yaml_config, ResultSaver

async def debug_production_issue():
    config = load_yaml_config("config.yaml")

    bug_description = "ç”Ÿäº§ç¯å¢ƒä¸­è®¿é—® user.email æ—¶å‡ºç° AttributeError"

    context = {
        "error_message": "AttributeError: 'NoneType' object has no attribute 'get'",
        "file_path": "app.py",
        "line_number": 45,
        "code_snippet": """
def process_user_data(user_id):
    user = fetch_user(user_id)
    user_email = user.get('email')  # ç¬¬ 45 è¡Œ - æ­¤å¤„é”™è¯¯
    return send_email(user_email)
        """,
        "expected_behavior": "åº”è¯¥ä¼˜é›…åœ°å¤„ç†ç¼ºå¤±çš„ç”¨æˆ·",
        "actual_behavior": "ä»¥ AttributeError å´©æºƒ",
        "reproduction_steps": [
            "è°ƒç”¨ process_user_data(999999)",  # æ— æ•ˆçš„ç”¨æˆ· ID
            "fetch_user è¿”å› None",
            "ä»£ç å°è¯•åœ¨ None ä¸Šè°ƒç”¨ .get()"
        ],
        "stack_trace": """
Traceback (most recent call last):
  File "app.py", line 45, in process_user_data
    user_email = user.get('email')
AttributeError: 'NoneType' object has no attribute 'get'
        """,
        "environment": "production",
        "occurrence_rate": "5% çš„è¯·æ±‚",
        "affected_users": "å…·æœ‰æ— æ•ˆä¼šè¯ ID çš„æ–°ç”¨æˆ·"
    }

    # è¿è¡Œè°ƒè¯•
    result = await run_code_debugger(config, bug_description, context)

    # æ˜¾ç¤ºç»“æœ
    print(f"\n{'='*60}")
    print(f"è°ƒè¯•ä¼šè¯: {result['title']}")
    print(f"{'='*60}")

    print(f"\nğŸ“Š æ‘˜è¦: {result['summary']}")

    print(f"\nğŸ” æ ¹å› :")
    print(f"  åˆ†ç±»: {result['root_cause']['category']}")
    print(f"  ç½®ä¿¡åº¦: {result['root_cause']['confidence']}")
    print(f"  æè¿°: {result['root_cause']['description']}")

    print(f"\nğŸ’¡ å»ºè®®ä¿®å¤:")
    print(f"  æ–‡ä»¶: {result['proposed_fix']['file_path']}")
    print(f"\n  ä¿®å¤å‰:\n{result['proposed_fix']['before_code']}")
    print(f"\n  ä¿®å¤å:\n{result['proposed_fix']['after_code']}")
    print(f"\n  è¯´æ˜: {result['proposed_fix']['explanation']}")

    print(f"\nğŸ›¡ï¸ é¢„é˜²å»ºè®®:")
    for i, rec in enumerate(result['prevention_recommendations'], 1):
        print(f"  {i}. {rec}")

    # ä¿å­˜è¯¦ç»†ç»“æœ
    saver = ResultSaver()
    saver.save(result, "debug_results")

    print(f"\nâœ… è°ƒè¯•ä¼šè¯å®Œæˆ!")
    print(f"   è¿­ä»£æ¬¡æ•°: {result['metadata']['iterations']}")
    print(f"   æˆåŠŸ: {result['metadata']['success']}")

if __name__ == "__main__":
    asyncio.run(debug_production_issue())
```

**è¾“å‡º**:

```
============================================================
è°ƒè¯•ä¼šè¯: Debug Session: ç”Ÿäº§ç¯å¢ƒä¸­è®¿é—® user.email æ—¶å‡ºç° AttributeError
============================================================

ğŸ“Š æ‘˜è¦: è¯†åˆ«å‡º fetch_user å¯¹æ— æ•ˆ ID è¿”å› None,ä½†è°ƒç”¨ä»£ç å‡è®¾å®ƒæ€»æ˜¯è¿”å› dictã€‚é€šè¿‡åœ¨è®¿é—®ç”¨æˆ·å¯¹è±¡ä¹‹å‰æ·»åŠ  None æ£€æŸ¥æ¥ä¿®å¤ã€‚

ğŸ” æ ¹å› :
  åˆ†ç±»: Data Issues
  ç½®ä¿¡åº¦: High
  æè¿°: fetch_user å‡½æ•°åœ¨ç»™å®šæ— æ•ˆç”¨æˆ· ID æ—¶è¿”å› None,ä½† process_user_data ä¸­çš„è°ƒç”¨ä»£ç å‡è®¾å®ƒæ€»æ˜¯è¿”å›å­—å…¸,å¹¶ç«‹å³åœ¨ç»“æœä¸Šè°ƒç”¨ .get() è€Œä¸æ£€æŸ¥ Noneã€‚

ğŸ’¡ å»ºè®®ä¿®å¤:
  æ–‡ä»¶: app.py

  ä¿®å¤å‰:
def process_user_data(user_id):
    user = fetch_user(user_id)
    user_email = user.get('email')
    return send_email(user_email)

  ä¿®å¤å:
def process_user_data(user_id):
    user = fetch_user(user_id)
    if user is None:
        raise ValueError(f"User {user_id} not found")
    user_email = user.get('email')
    return send_email(user_email)

  è¯´æ˜: åœ¨è®¿é—®ç”¨æˆ·å¯¹è±¡ä¹‹å‰æ·»åŠ æ˜¾å¼ None æ£€æŸ¥ä»¥é˜²æ­¢ AttributeErrorã€‚å¼•å‘æ›´å…·æè¿°æ€§çš„ ValueError ä»¥æŒ‡ç¤ºå®é™…é—®é¢˜(ç¼ºå°‘ç”¨æˆ·)ã€‚

ğŸ›¡ï¸ é¢„é˜²å»ºè®®:
  1. ä¸ºå¯ä»¥è¿”å› None çš„å‡½æ•°æ·»åŠ  Optional[dict] ç±»å‹æç¤º
  2. åœ¨ CI/CD æµæ°´çº¿ä¸­ä½¿ç”¨ mypy æˆ– pyright è¿›è¡Œé™æ€ç±»å‹æ£€æŸ¥
  3. æ·»åŠ  linting è§„åˆ™ä»¥æ£€æµ‹æœªç»æ£€æŸ¥çš„æ½œåœ¨ None è®¿é—®
  4. åˆ›å»ºè¦æ±‚å¯¹æ‰€æœ‰å¯é€‰è¿”å›è¿›è¡Œ None æ£€æŸ¥çš„ç¼–ç æ ‡å‡†
  5. ä¸“é—¨ä¸º None/é”™è¯¯æƒ…å†µæ·»åŠ å•å…ƒæµ‹è¯•,è€Œä¸ä»…ä»…æ˜¯æ­£å¸¸è·¯å¾„

âœ… è°ƒè¯•ä¼šè¯å®Œæˆ!
   è¿­ä»£æ¬¡æ•°: 2
   æˆåŠŸ: True
```

## ç›¸å…³ç¤ºä¾‹

- **01_competitive_intelligence** - ç”¨äºæ•°æ®æ”¶é›†çš„ Research æ¶æ„
- **03_marketing_content** - ç”¨äºè¿­ä»£æ”¹è¿›çš„ Critic-Actor
- **07_codebase_analysis** - ç”¨äºå¤§è§„æ¨¡åˆ†æçš„ MapReduce

## è®¸å¯è¯

MIT License - å‚è§æ ¹ç›®å½• LICENSE æ–‡ä»¶
