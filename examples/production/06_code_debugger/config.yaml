# Code Debugger - Reflexion Architecture
# Uses execute-reflect-improve loop for intelligent debugging

architecture: reflexion

# Business template configuration
business_template: code_debugger

# Template variables for prompt customization
codebase: "Application Codebase"
language: "Python"
bug_description: ""

# Debugging configuration
debugging:
  max_iterations: 5           # Maximum debugging attempts
  success_threshold: 0.9      # Confidence threshold for successful debug
  enable_learning: true       # Learn from failed attempts
  preserve_history: true      # Keep debugging history for analysis

# Debugging strategies
strategies:
  initial_analysis:
    name: "error_trace_analysis"
    description: "Analyze error messages and stack traces"
    tools: ["Read", "Bash"]
    priority: 1

  code_inspection:
    name: "suspicious_code_review"
    description: "Review code around error location"
    tools: ["Read", "Grep"]
    priority: 2

  hypothesis_testing:
    name: "reproduce_and_test"
    description: "Reproduce issue and test hypotheses"
    tools: ["Bash", "Write", "Read"]
    priority: 3

  dependency_check:
    name: "dependency_analysis"
    description: "Check dependencies and environment"
    tools: ["Bash", "Read"]
    priority: 4

  integration_test:
    name: "integration_validation"
    description: "Test integration points and data flow"
    tools: ["Bash", "Read"]
    priority: 5

# Reflexion loop configuration
reflexion_config:
  executor:
    name: "debug_executor"
    role: "Execute debugging strategies and collect evidence"
    tools: ["Read", "Write", "Bash", "Grep"]

  reflector:
    name: "debug_reflector"
    role: "Analyze debugging results and identify what went wrong"
    focus_areas:
      - "Why did this debugging attempt fail?"
      - "What assumptions were incorrect?"
      - "What new information was discovered?"
      - "What should we try differently?"

  improver:
    name: "strategy_improver"
    role: "Refine debugging strategy based on reflection"
    capabilities:
      - "Adjust strategy based on new evidence"
      - "Prioritize unexplored hypotheses"
      - "Combine insights from multiple attempts"
      - "Escalate if pattern suggests deeper issue"

# Bug categories and patterns
bug_categories:
  runtime_error:
    patterns:
      - "AttributeError"
      - "TypeError"
      - "ValueError"
      - "IndexError"
      - "KeyError"
    strategies: ["error_trace_analysis", "code_inspection", "hypothesis_testing"]

  logic_error:
    patterns:
      - "Incorrect output"
      - "Wrong calculation"
      - "Unexpected behavior"
    strategies: ["code_inspection", "hypothesis_testing", "integration_test"]

  performance_issue:
    patterns:
      - "Slow performance"
      - "Timeout"
      - "High memory usage"
    strategies: ["code_inspection", "dependency_check", "integration_test"]

  integration_error:
    patterns:
      - "Connection error"
      - "API error"
      - "Database error"
    strategies: ["dependency_check", "integration_test", "error_trace_analysis"]

  environment_issue:
    patterns:
      - "Import error"
      - "Module not found"
      - "Permission denied"
    strategies: ["dependency_check", "error_trace_analysis"]

# Root cause analysis framework
root_cause_analysis:
  categories:
    - name: "Code Logic"
      indicators: ["Incorrect condition", "Off-by-one error", "Missing edge case"]
    - name: "Data Issues"
      indicators: ["Invalid input", "Null/undefined", "Type mismatch"]
    - name: "Dependencies"
      indicators: ["Version conflict", "Missing package", "API change"]
    - name: "Environment"
      indicators: ["Path issue", "Permission", "Configuration"]
    - name: "Concurrency"
      indicators: ["Race condition", "Deadlock", "Thread safety"]

# Fix validation
fix_validation:
  require_tests: true           # Require test to validate fix
  regression_check: true        # Check for regressions
  code_review: true             # Review proposed fix
  documentation: true           # Require fix documentation

# Output configuration
output:
  directory: "outputs/debug_sessions"
  format: "markdown"  # Options: json, markdown, pdf

  report_sections:
    - "Bug Summary"
    - "Debugging Timeline"
    - "Root Cause Analysis"
    - "Failed Attempts & Learnings"
    - "Proposed Fix"
    - "Fix Validation"
    - "Prevention Recommendations"

# Model configuration
models:
  lead: "sonnet"        # Orchestrator
  executor: "sonnet"    # Debugging execution requires reasoning
  reflector: "opus"     # Deep reflection benefits from best model
  improver: "sonnet"    # Strategy improvement

# Advanced options
advanced:
  enable_git_bisect: false      # Use git bisect to find regression
  enable_llm_debugging: true    # Use LLM to analyze code
  enable_static_analysis: true  # Run linters and type checkers
  enable_profiling: false       # Profile performance issues
  parallel_hypotheses: false    # Test multiple hypotheses in parallel
  verbose_logging: true         # Detailed debugging logs

# Example debugging scenarios
debugging_scenarios:
  quick_fix:
    description: "Simple bugs with clear error messages"
    max_iterations: 2
    strategies: ["error_trace_analysis", "code_inspection"]

  standard_debug:
    description: "Typical bugs requiring investigation"
    max_iterations: 5
    strategies: ["error_trace_analysis", "code_inspection", "hypothesis_testing"]

  deep_investigation:
    description: "Complex bugs requiring extensive analysis"
    max_iterations: 10
    strategies: ["error_trace_analysis", "code_inspection", "hypothesis_testing",
                 "dependency_check", "integration_test"]

  performance_issue:
    description: "Performance problems requiring profiling"
    max_iterations: 7
    strategies: ["code_inspection", "dependency_check", "integration_test"]
    enable_profiling: true
